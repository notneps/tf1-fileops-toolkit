import os
import re

def fix_extensions(folder, dry_run=True):
    """
    Detect and fix wrongly renamed files like 'file.53jpg' -> 'file_53.jpg'.
    
    Args:
        folder (str): Path to the folder with files.
        dry_run (bool): If True, only print what would be renamed (default).
    """
    # Regex matches: base name, digits, and extension
    pattern = re.compile(r"^(.*)\.(\d+)(jpg|jpeg|png|heic|gif|tif|tiff)$", re.IGNORECASE)

    for fname in os.listdir(folder):
        match = pattern.match(fname)
        if match:
            base, number, ext = match.groups()
            new_name = f"{base}_{number}.{ext.lower()}"
            old_path = os.path.join(folder, fname)
            new_path = os.path.join(folder, new_name)

            if dry_run:
                print(f"Would rename: {fname} -> {new_name}")
            else:
                print(f"Renaming: {fname} -> {new_name}")
                os.rename(old_path, new_path)


if __name__ == "__main__":
    folder_path = r"C:\Users\nephi\Box\FSL + WALLY - Pandryn\JA\Batch 11\領収書 (Receipts)\店舗 (Store)\fix_filename"  # <-- change this
    fix_extensions(folder_path, dry_run=False)  # first run in dry-run mode
    # fix_extensions(folder_path, dry_run=False)  # uncomment to actually rename
